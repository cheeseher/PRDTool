# 开发环境调试功能使用指南

## 概述

为了提高开发效率，本项目提供了完整的开发环境调试功能，包括认证绕过、模拟用户登录、调试面板等。这些功能**仅在开发环境中可用**，生产环境会自动禁用并清理相关数据。

## 🔧 功能特性

### 1. 认证绕过功能
- **自动检测开发环境**：基于 `localhost`、`127.0.0.1` 或 `import.meta.env.DEV`
- **一键跳过认证**：无需每次输入用户名密码
- **角色模拟**：支持管理员和普通用户两种角色
- **状态持久化**：设置会保存在 localStorage 中

### 2. 开发者调试面板
- **实时状态监控**：显示当前认证状态、用户信息、环境信息
- **快速操作**：一键切换用户角色、启用/禁用认证绕过
- **快速导航**：直接跳转到不同页面
- **调试工具**：输出调试信息、清除数据等

### 3. 安全保障
- **生产环境保护**：生产环境自动禁用所有调试功能
- **数据清理**：生产环境自动清理开发数据
- **明显标识**：开发环境有明显的视觉标识

## 🚀 快速开始

### 方法一：登录页面快捷按钮

1. 访问登录页面 `http://localhost:5173/admin/login`
2. 在开发环境中，页面底部会显示橙色的"🛠️ 开发环境选项"区域
3. 点击以下按钮之一：
   - **跳过认证（管理员模式）**：以管理员身份直接进入系统
   - **跳过认证（普通用户模式）**：以普通用户身份进入系统

### 方法二：快捷键操作

- **Ctrl+Shift+D**（Mac: Cmd+Shift+D）：快速切换认证绕过状态
- **Ctrl+Shift+P**（Mac: Cmd+Shift+P）：打开/关闭调试面板

### 方法三：调试面板

1. 按 `Ctrl+Shift+P` 打开调试面板
2. 在面板中可以：
   - 查看当前环境和认证状态
   - 启用/禁用认证绕过
   - 切换用户角色
   - 快速导航到不同页面
   - 输出调试信息
   - 清除所有开发数据

## 📋 详细功能说明

### 认证绕过控制

```typescript
import { DevAuthBypass } from './lib/devUtils'

// 启用认证绕过
DevAuthBypass.enable()

// 禁用认证绕过
DevAuthBypass.disable()

// 检查是否已启用
const isEnabled = DevAuthBypass.isEnabled()

// 设置模拟用户
DevAuthBypass.setMockUser('admin') // 或 'user'

// 获取当前模拟用户
const mockUser = DevAuthBypass.getMockUser()
```

### 环境检测

```typescript
import { isDevelopment, isProduction } from './lib/devUtils'

// 检查是否为开发环境
if (isDevelopment()) {
  console.log('当前为开发环境')
}

// 检查是否为生产环境
if (isProduction()) {
  console.log('当前为生产环境')
}
```

### 模拟用户数据

系统提供两种预设的模拟用户：

```typescript
// 管理员用户
{
  id: 'dev-admin-001',
  email: 'dev-admin@localhost.com',
  name: '开发管理员',
  is_admin: true,
  avatar_url: null
}

// 普通用户
{
  id: 'dev-user-001',
  email: 'dev-user@localhost.com',
  name: '开发用户',
  is_admin: false,
  avatar_url: null
}
```

## 🎯 使用场景

### 1. 页面开发调试
- 快速进入需要认证的页面
- 测试不同用户角色的权限
- 验证页面布局和功能

### 2. 功能测试
- 测试管理员专用功能
- 验证权限控制逻辑
- 模拟不同用户的操作流程

### 3. UI/UX 调试
- 快速切换用户状态
- 测试响应式设计
- 验证交互效果

## 🔒 安全机制

### 生产环境保护

1. **自动检测**：系统会自动检测当前环境
2. **强制禁用**：生产环境强制禁用所有调试功能
3. **数据清理**：生产环境自动清理开发相关数据
4. **构建优化**：生产构建会移除调试代码

### 环境判断逻辑

```typescript
// 开发环境判断
const isDev = (
  import.meta.env.DEV ||
  window.location.hostname === 'localhost' ||
  window.location.hostname === '127.0.0.1' ||
  window.location.hostname.includes('localhost')
)

// 生产环境强制检查
if (import.meta.env.PROD && !import.meta.env.DEV) {
  // 强制禁用所有调试功能
}
```

## 🎨 视觉标识

### 开发环境标识
- **顶部橙色横条**：显示当前为开发模式
- **用户信息显示**：显示当前模拟用户信息
- **快捷键提示**：提示可用的快捷键操作

### 登录页面标识
- **橙色开发选项区域**：明显的开发环境选项
- **图标和颜色区分**：使用橙色主题区分开发功能

## 🛠️ 故障排除

### 常见问题

1. **认证绕过不生效**
   - 检查是否在开发环境（localhost）
   - 确认已启用认证绕过功能
   - 尝试刷新页面

2. **调试面板无法打开**
   - 确认快捷键 `Ctrl+Shift+P` 是否正确
   - 检查浏览器控制台是否有错误
   - 确认当前为开发环境

3. **用户角色切换无效**
   - 切换后需要刷新页面
   - 检查 localStorage 中的数据
   - 尝试清除所有数据后重新设置

### 重置方法

```typescript
// 方法1：使用调试面板的"清除所有数据"按钮

// 方法2：手动清除
DevAuthBypass.clear()
localStorage.clear()
sessionStorage.clear()
window.location.reload()

// 方法3：浏览器开发者工具
// Application -> Storage -> Clear storage
```

## 📝 开发建议

### 最佳实践

1. **开发流程**
   - 启动项目后，使用认证绕过快速进入系统
   - 根据需要切换不同用户角色测试
   - 使用调试面板监控状态

2. **测试建议**
   - 定期测试正常认证流程
   - 验证生产环境构建是否正确移除调试功能
   - 测试不同用户角色的权限边界

3. **代码规范**
   - 调试代码使用 `isDevelopment()` 包裹
   - 避免在生产代码中硬编码调试逻辑
   - 使用提供的工具函数而非自定义实现

### 性能考虑

- 调试功能对性能影响极小
- 生产环境完全移除，无性能损耗
- localStorage 操作已优化，不影响页面加载

## 🔄 更新日志

### v1.0.0
- ✅ 基础认证绕过功能
- ✅ 模拟用户登录
- ✅ 开发者调试面板
- ✅ 快捷键支持
- ✅ 生产环境安全保护
- ✅ 视觉标识和用户体验优化

---

## 📞 技术支持

如果在使用过程中遇到问题，请：

1. 查看浏览器控制台错误信息
2. 检查网络请求状态
3. 确认环境配置是否正确
4. 参考本文档的故障排除部分

**注意**：这些调试功能仅用于开发环境，请勿在生产环境中尝试使用。